var StarWars=new(StarWarsOpening=function(){function t(t){this.el=$(t.el),this.audio=this.el.find("audio").get(0),this.audioDefer=$.Deferred();var e=this;this.audio.oncanplaythrough=function(){e.audioDefer.resolve()},this.start=this.el.find(".start"),this.animation=this.el.find(".animation"),this.reset(),$(this.audio).bind("ended",$.proxy(function(){this.audio.currentTime=0,this.reset();var t=this.opening;$("#f-intro").val(t.intro),$("#f-logo").val(t.logo||"Star\nwars"),$("#f-episode").val(t.episode),$("#f-title").val(t.title),$("#f-text").val(t.text),$("#f-center").prop("checked",t.center||!1),$("#f-text").css("text-align",t.center?"center":"initial"),setTimeout(function(){"block"===$(".start").css("display")&&$("body").removeClass("running")},1e4)},this))}return t.prototype.reset=function(){this.start.show(),$(".pageHide").show(),this.cloned=this.animation.clone(!0),this.animation.remove(),this.animation=this.cloned,$(window).trigger("resize")},t.prototype.resetAudio=function(){this.audio.pause(),this.audio.currentTime=0},t.prototype.play=function(){this.start.hide(),$(".pageHide").hide(),unsetLoading(),$("body").removeClass("running"),$("body").addClass("running"),$("body").scrollTop(0),this.audio.play(),this.el.append(this.animation);var t=$(".titles > div",this.animation)[0];if(1977<t.offsetHeight){for(var e,t=20-.04041570438799076*(t.offsetHeight-1977),n=document.styleSheets,a=0;a<n.length;++a)for(var o=0;o<n[a].cssRules.length;++o){var i=n[a].cssRules[o];"titles"==i.name&&i.type==CSSRule.KEYFRAMES_RULE&&(e=i)}e&&e.appendRule("100% { top: "+t+"% }")}},t}())({el:".starwars"});function createdIntros(){this.template=Handlebars.compile('{{#if intros.length}}<div id="box">{{#each intros}}<div><div class="circCont"><button data-id="{{@index}}" class="removeButton circle fromMiddle"><span></span></button></div><a href="#!/{{this.key}}" class="link">{{this.title}}</a></div>{{/each}}</div>{{/if}}'),this.element=$("#createdIntros"),this.remove=function(e){var n=this;swal({html:!0,title:'<h2 style="font-family: StarWars;">remove intro</h2>',text:'<p style="text-align: justify">This will not remove the intro from the database. Are you sure you want to remove the intro from this browser?<br></p>',showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",animation:"slide-from-top"},function(t){t&&((t=JSON.parse(localStorage.StarWarsIntros)).splice(e,1),localStorage.StarWarsIntros=JSON.stringify(t),n.load())})},this.load=function(){var t=localStorage.StarWarsIntros?JSON.parse(localStorage.StarWarsIntros):[],t=$(this.template({intros:t})),e=this;t.find(".removeButton").click(function(t){e.remove(t.target.dataset.id)}),this.element.html(t)};this.save=function(t,e){var n=localStorage.StarWarsIntros?JSON.parse(localStorage.StarWarsIntros):[],e=function(t){for(var e=["title","episode","logo","text"],n=0;n<e.length;n++){var a=t[e[n]];if(""!==a.trim())return a.slice(0,50)}}(e);n.push({title:e,key:t}),localStorage.StarWarsIntros=JSON.stringify(n)}}function ajaxErrorFunction(t){var e=encodeURI("Hi, the website didn't work as expected. \n\n"+t);return function(){swal({html:!0,title:'<h2 style="font-family: StarWars;">an error has occured</h2>',text:'<p style="text-align: left">Something went wrong! Sorry about that! Please try again, if this error repeats please contact us: : <br><a style="color: #ffd54e;" href="mailto:brorlandi@gmail.com,nihey.takizawa@gmail.com?Subject=SWIC%20Problem&Body='+e+'" target="_blank">brorlandi@gmail.com<br> nihey.takizawa@gmail.com</a></p>',type:"error",confirmButtonText:"Ok"})}}(CreatedIntros=new createdIntros).load(),swal.setDefaults({customClass:"star-wars-alert"});var OpeningKey=null,defaultOpening=null,audio=document.getElementsByTagName("audio")[0],audioIsLoaded=!1,loadData=function(){audioIsLoaded||(audio.load(),audioIsLoaded=!0)},notPlayed=(document.body.addEventListener("touchstart",loadData),window.addEventListener("keydown",function(t){(document.activeElement.type||"").startsWith("text")||-1<[32,37,38,39,40].indexOf(t.keyCode)&&t.preventDefault()},!1),!0),showFooter=!0;function getInternetExplorerVersion(){var t,e=-1;return"Microsoft Internet Explorer"==navigator.appName?(t=navigator.userAgent,null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(t=navigator.userAgent,null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))),e}window.setLoading=function(){$("#loader").show(),$("#form-starwars").hide()},window.unsetLoading=function(){$("#loader").hide(),$("#form-starwars").show()},setLoading(),$("#form-starwars").submit(function(t){t.preventDefault();var e,n=getOpeningFormValues(),t=StarWars.opening;if(!isOpeningsDifferents(n,t))return t=location.hash,e="!/"+OpeningKey,void(t!==(location.hash=e)&&window.dispatchEvent(new Event("hashchange")));if(!isOpeningsDifferents(n,defaultOpening))return setLoading(),void(location.hash="!/Episode8");t=n.logo.split("\n");if(2<t.length)sweetAlert("Oops...","Logo can't have more than 2 lines.","warning");else if(2<n.intro.split("\n").length)sweetAlert("Oops...","Intro text can't have more than 2 lines.","warning");else{for(var a in n)if("string"==n[a]&&-1<n[a].indexOf("??"))return void sweetAlert("Oops...",'Your text can\'t contain the sequence "??", please fix it and submit again.',"error");setLoading(),$.ajax({url:"https://starwarsopeninga.firebaseio.com/openings.json",method:"POST",data:JSON.stringify(n),dataType:"json",success:function(t){t="A"+t.name.substring(1);CreatedIntros.save(t,n),location.hash="!/"+t},error:ajaxErrorFunction("Error when creating the intro.\n\n"+JSON.stringify(n))})}}),$(window).on("hashchange",function(){$("#playBut").remove();var t,e=location.hash.replace("#!/","").split("/"),l=e[0],d=!1;try{d="edit"===e[1]}catch(t){}if($("body").removeClass("running"),""!=l){$("[name=custom]").val(l);try{var l=parseSpecialKeys(l),n="A"===(t=l).charAt(0)?"https://starwarsopeninga.firebaseio.com/openings/-"+(t=t.substr(1))+".json":"https://starwarsopening.firebaseio.com/openings/-"+t+".json";$.ajax({url:n,success:function(t){if(null==t)sweetAlert("Oops...","Introduction not found!","error");else{StarWars.opening=t,OpeningKey=l,$("#videoButton").show();var e,n=t.intro.replace(/</g,"&lt;"),n=(n=(n=n.replace(/>/g,"&gt;")).replace(/\n/g,"<br>"),StarWars.animation.find("#intro").html(n),StarWars.animation.find("#episode").text(t.episode),StarWars.animation.find("#title")),a=(checkCompatibleSWFont(t.title)&&n.addClass("SWFont"),n.text(t.title),t.text.split("\n")),o=StarWars.animation.find("#text");for(e in o.text(""),a)o.append($("<p>").text(a[e]));o.css("text-align",t.center?"center":""),$("#logosvg",StarWars.animation).css("width",$(window).width()+"px"),$("#logoimg",StarWars.animation).css("width",$(window).width()+"px");function i(){$.when(StarWars.audioDefer).then(function(){0!=StarWars.audio.buffered.end(StarWars.audio.buffered.length-1)||audioIsLoaded?(notPlayed=!1,StarWars.play()):(unsetLoading(),playbutton=$('<div class="verticalWrapper"><div class="playAudio"><button id="playBut" class="playButton" style="font-size: 80px">Play</button></div></div>'),$("body").append(playbutton),$("#playBut",playbutton).click(function(){setLoading(),playbutton.remove()}),StarWars.audio.oncanplaythrough=function(){notPlayed=!1,StarWars.play()}),d&&(StarWars.audio.currentTime=97,$("#form-starwars").show())})}var r,n=t.logo||"star\nwars",t=n.split("\n"),s=t[0],t=t[1]||"";"star\nwars"!=n.toLowerCase()?((n=$("#logosvg text",StarWars.animation))[0].textContent=s,n[1].textContent=t,r="0 0 "+200*(s.length>t.length?s:t).length+" 500",$("#logosvg",StarWars.animation).each(function(){$(this)[0].setAttribute("viewBox",r)}),$("#logosvg",StarWars.animation).show(),$("#logoimg",StarWars.animation).hide()):($("#logosvg",StarWars.animation).hide(),$("#logoimg",StarWars.animation).show());document.hasFocus()?i():$(window).focus(function(){notPlayed&&i()})}},error:ajaxErrorFunction("Error when try to load the intro "+l)})}catch(t){location.hash="",setLoading()}}else notPlayed?unsetLoading():(StarWars.reset(),StarWars.resetAudio())}),$(document).ready(function(){if(-1!==getInternetExplorerVersion())return sweetAlert("Internet Explorer Detected","This website is not compatible with Internet Explorer, please use Chrome. Sorry for the inconvenience.","error"),void unsetLoading();defaultOpening=getOpeningFormValues(),window.dispatchEvent(new Event("hashchange")),$("#f-center").change(function(){var t=$(this).is(":checked");$("#f-text").css("text-align",1==t?"center":"initial")})});var calcTime=function(t){var t=30*(t+1),e=Math.floor(t/60),n=Math.floor(e/24),a="";return 0<n&&(a+=n+" days"),n<3&&(0<(e%=24)&&(a+=" "+e+" hours"),0<(t%=60)&&(a+=" "+t+" minutes")),a};function validateEmail(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}var requestVideo=function(t,e){return!1};function getOpeningFormValues(){return{intro:$("#f-intro").val(),logo:$("#f-logo").val(),episode:$("#f-episode").val(),title:$("#f-title").val(),text:$("#f-text").val(),center:$("#f-center").prop("checked")}}function isOpeningsDifferents(t,e){var n=[];return null===t||null==e||(n.push(t.intro!==e.intro),n.push(t.logo!==e.logo),n.push(t.episode!==e.episode),n.push(t.title!==e.title),n.push(t.text!==e.text),n.push(t.center!==e.center&&void 0!==e.center),n.reduce(function(t,e){return t||e},!1))}function parseSpecialKeys(t){switch(t){case"Episode7":return"AKcKeYMPogupSU_r1I_g";case"Episode8":return"AL6yNfOxCGkHKBUi54xp";default:return t}}function checkCompatibleSWFont(t){for(var e=" qwertyuiopasdfghjklzxcvbnm0123456789!$".split(""),n=t.toLowerCase().split("").filter(function(t,e,n){return n.indexOf(t)===e}),a=0;a<n.length;a++)if(-1==e.indexOf(n[a]))return!1;return!0}$("#videoButton").click(function(){return!0}),window.localStorage.setItem("StarWarsIntros",'[{"title":"THE MANUAL MENACE","key":"AN-PkHf-k0FgxKTTKRcA"},{"title":"ATTACK OF THE PIPELINES","key":"AN-PlEbtXFRFZTnFznwc"},{"title":"REVENGE OF THE AUTOMATED TESTING","key":"AN-Pm81Gmfs0g0ioQHfw"},{"title":"A SECURE HOPE","key":"AN-Pmtuc82D6y3UWPCWq"},{"title":"RETURN OF THE MONITORING","key":"AN-PnnCgCljRjZ-cOGBI"},{"title":"THE DEPLOYMENTS STRIKE BACK","key":"AN-PogOik9g8YPNIt5-l"},{"title":"THE LAST UNICORN DEVELOPER","key":"AN-PpWgIVFQMee1wAWI_"}]');